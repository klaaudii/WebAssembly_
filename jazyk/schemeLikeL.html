<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>SchemeLike Editor</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="./ace/ace.js"></script>
<script src="./ace/ext-language_tools.js"></script>

<!--(fill-rect (create-canvas 512 512) 0 0 20 20 (color 225 0 225 225))-->

<!--(define v (vector 1 2 3))-->
<!--(define v2 (vector 4 5 6 ))-->
<!--(define v3 (vector 4 5 6 7))-->
<!--(define canvas (create-canvas 512 512))-->
<!--(define canvas2 (create-canvas 512 512))-->
<!--(fill-rect canvas 0 0 20 20 (color 0 0 0 255))-->
<!--(fill-rect canvas 0 10 20 20 (color 255 0 0 255))-->


<style>
    body {
        margin: 0;
        padding: 0;
        background-color: #2d2d2d;
        color: #f8f8f8;
        display: flex;
        height: 100vh;
    }

    #editor-container {
        margin: 15px;
        min-width: 10%;
        width: 50%;
        height: calc(100% - 30px);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        resize: horizontal;
    }

    #editor {
        background-color: #272822;
        overflow-y: auto;
        resize: vertical;
        min-height: 10%;
        max-height: 100%;
        width: 100%;
        height: 500px;
    }

    #buttons {
        margin: 10px;
        display: flex;
        justify-content: right;
        background-color: #2d2d2d;
    }

    #output {
        padding: 5px;
        flex: 3;
        background-color: #272822;
        overflow-y: auto;
        border: none;
        color: #f8f8f8;
        font-size: 14px;
    }

    #canvas-container {
        margin: 15px;
        height: calc(100% - 30px);
    }

    button {
        margin-left: 10px;
        padding: 8px 32px;
        font-size: 16px;
        background-color: #4CAF50;
        color: #2d2d2d;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background-color: #48914a
    }
</style>

<body>


<!--(fill-arc board 150 50 40 white)-->
<!--(fill-arc board 250 50 40 white)-->
<!--(fill-arc board 350 50 40 white)-->
<!--(fill-arc board 450 50 40 (color 255 0 0 200))-->
<!--(fill-arc board 450 50 34 red)-->

<div id="editor-container">
    <div id="editor">



(define board-state (list (vector 0 0 0 0 0 0 0) (vector 0 0 0 0 0 0 0) (vector 0 0 0 0 0 0 0) (vector 0 0 0 0 0 0 0) (vector 0 0 0 0 0 0 0) (vector 0 0 0 0 0 0 0)))
(define n-rows 7)


(define red (color 255 0 0 255))
(define white (color 255 255 255 255))
(define blue (color 0 0 200 255))
(define yellow (color 255 255 0 255))
(define token-radius 45)
(define board (canvas 700 600))
(define player 1)


(define (draw-token x y col)
(fill-arc board (+ 50 (* x 100)) (+ 50 (* y 100)) token-radius col))


(define (draw-token-row i j)
(if (<= j 7) (begin (draw-token j i white) (draw-token-row i (+ j 1))) ))


(define (draw-token-spaces i)
(if (<= i 6) (begin (draw-token-row i 0) (draw-token-spaces (+ i 1)))))


(define (draw-board)
(fill-rect board 0 0 700 600 blue)
(draw-token-spaces 0))


(draw-board)


(define (token-space-is-empty r c)
(if (> r 5) 0 (if (= (vector-ref (list-ref board-state r) c) 0) 1 0)))


(define (get-dir-token-count r c dr dc count)
(let ((nr (+ r dr)) (nc (+ c dc)))

(if (and (<= nr 5) (>= nr 0) (>= nc 0) (<= nc 6))
(if (= (vector-ref (list-ref board-state r) c) (vector-ref (list-ref board-state nr) nc))

(get-dir-token-count nr nc dr dc (+ 1 count))  count ) count)))

(define (check-dir r c dr dc)
(if (> (+ (get-dir-token-count r c dr dc 0) (get-dir-token-count r c (* -1 dr) (* -1 dc) 0)) 2) 1 0))


(define (check-four r c)
(if (= (check-dir r c 0 1) 1) 1
(if (= (check-dir r c 1 0) 1) 1
(if (= (check-dir r c 1 -1) 1) 1
(if (= (check-dir r c 1 1) 1) 1 0)))))

(define (new-game) (display 123456))


(define (put-token r c)
(if (= player 1)
(begin (draw-token c r red) (set! player 2) (vector-set! (list-ref board-state r) c 2))
(begin (draw-token c r yellow) (vector-set! (list-ref board-state r) c 1) (set! player 1)))
(if (= (check-four r c) 1) (begin (if (= player 2) (fill-text board (vector 82 69 68 32 87 79 78 33) 250 250)
(fill-text board (vector 89 69 76 76 79 87 32 87 79 78 33) 250 250))
(canvas-onclick board new-game)
)))




(define (click x y)
(let ((c (quotient (ceiling x) 100))(r (quotient (ceiling y) 100)))
(if (and (= (token-space-is-empty r c) 1) (= (token-space-is-empty (+ r 1) c) 0))  (put-token r c))))

(canvas-onclick board click)








    </div>
    <div id="buttons">
        <button id="compile-button" onclick="compile()">Compile</button>
        <button id="run-button" onclick="run()">Run</button>
    </div>
    <textarea id="output"></textarea>
</div>
<div id="canvas-container">
</div>





<!--<textarea id="userCode" rows="10" cols="50">-->
<!--(define (fib3 n a b) (if (<= n 2) a (fib3 (- n 1) (+ a b) a)))-->
<!--(define (fib2 n) (fib3 n 1 1))-->
<!--(fib2 7)-->

<!--</textarea>-->
<!--&lt;!&ndash;    TODO dories tie medzery&ndash;&gt;-->
<!--<br>-->
<!--<button onclick="compile()">Compile to Wasm</button>-->
<!--<button onclick="run()">Run Wasm</button><br>-->
<!--<textarea id="output" rows="10" cols="50">-->

<!--</textarea>-->

<!--<br>-->

<!--<div id="editor"></div>-->








<script type="module">





    import {compileToWasm, runWasm, initEditor} from './main.js';
    let wasmBinary;
    window.compile = compile
    window.run = run

    initEditor()

    function compile(){
        wasmBinary = compileToWasm()
    }

    async function run(){
        runWasm(wasmBinary)
    }

</script>
</body>
</html>

<!--antlr4 -Dlanguage=JavaScript SchemeLikeL.g4 -visitor-->
<!--treba zmenit cestu k antlr4 vo vygenerovanych filoch-->
<!--import antlr4 from './antlr4/index.web.js';-->

