<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport">
    <title>04 Interakcie</title>

</head>
<body>
<h3 id="wasmRetazec"></h3>
<script>

    let mem = new WebAssembly.Memory({initial: 1 });
    let i32v = new Int32Array(mem.buffer);
    let mem2 = new WebAssembly.Memory({initial: 1 });
    let i32v2 = new Int32Array(mem2.buffer);

    void async function(){

        let importObject =  {
            "env": {
                memory: mem,
                "fncJs": function(i){
                    console.log(i32v[10]);
                    i32v[10] = i;
                    setTimeout(()=> {document.body.append(document.createTextNode(`after 5 s`));},   5000)
                }
            }
        }

        let import2Object =  {
            "env": {
                memory: mem2,
                "fncJs": function(i){
                    console.log(i32v2[10]);
                    i32v2[10] = i;
                    setTimeout(()=> {document.body.append(document.createTextNode(`after 5 s`));},   5000)
                }
            }
        }

        let instance1 = (await WebAssembly.instantiateStreaming(fetch('pamat.wasm'), importObject)).instance
        let instance2 = (await WebAssembly.instantiateStreaming(fetch('pamat.wasm'), import2Object)).instance
        let instance3 = (await WebAssembly.instantiateStreaming(fetch('pamat.wasm'), importObject)).instance

        instance1.exports.fnc(1);
        console.log(instance1.exports.var)

        instance2.exports.fnc(1);
        console.log(instance2.exports.var)

        instance3.exports.fnc(1);
        console.log(instance3.exports.var)

        let importO =  {
            "env": {
                "fncJs": function(i){
                    console.log(i32v[10]);
                    i32v[10] = i;
                    setTimeout(()=> {document.body.append(document.createTextNode(`after 5 s`));},   5000)
                }
            }
        }


        let instance4 = (await WebAssembly.instantiateStreaming(fetch('pamat.wasm'), importO)).instance
        let instance5 = (await WebAssembly.instantiateStreaming(fetch('pamat.wasm'), importO)).instance

        console.log(instance4.exports.fnc2(1));
        console.log(instance5.exports.fnc2(1));


    }();

</script>
</body>
</html>


